# å¯¼èˆªç½‘ç«™é¡¹ç›® PRD

## 1. é¡¹ç›®æ„¿æ™¯
- ä¸ºéœ€è¦å¿«é€Ÿè®¿é—®é«˜é¢‘ç½‘ç«™ä¸å·¥å…·çš„åˆ›ä½œè€…ã€å­¦ç”Ÿä¸èŒåœºäººå£«ï¼Œæä¾›ä¸€ä¸ªå¯å®šåˆ¶ã€å“åº”å¼ã€è½»é‡çš„å¯¼èˆªä¸»é¡µã€‚
- é€šè¿‡æ¸…æ™°çš„åˆ†ç±»ã€æ™ºèƒ½æ¨èä¸é”®ç›˜å¿«æ·æ“ä½œï¼Œå¸®åŠ©ç”¨æˆ·åœ¨ç§’çº§å®Œæˆä¿¡æ¯æ£€ç´¢ï¼Œé™ä½â€œæ‰¾ä¸åˆ°å…¥å£â€çš„æ—¶é—´æˆæœ¬ã€‚

## 2. ç”¨æˆ·ç”»åƒ & åœºæ™¯
| è§’è‰² | ç›®æ ‡ | æ ¸å¿ƒç—›ç‚¹ | ä½¿ç”¨åœºæ™¯ |
| --- | --- | --- | --- |
| å­¦ä¹ å‹ç”¨æˆ· | æ‰¾åˆ°è¯¾ç¨‹ã€é¢˜åº“ã€æ•ˆç‡å·¥å…· | ä¹¦ç­¾å‡Œä¹±ã€è®¾å¤‡ä¸åŒæ­¥ | è¯¾å‰å¼€å¯å¯¼èˆªé¡µé¢ä¸€é”®è¿›å…¥å¸¸ç”¨ç½‘ç«™ |
| å†…å®¹åˆ›ä½œè€… | å¿«é€Ÿåˆ‡æ¢å†™ä½œ/ç´ æ/å‘å¸ƒå¹³å° | éœ€è¦ç®¡ç†å¤šå¹³å°é“¾æ¥ | æ¯å¤©å¼€æœºç¬¬ä¸€ä»¶äº‹æ‰“å¼€å¯¼èˆªé¡µ |
| å›¢é˜Ÿåä½œæˆå‘˜ | è®¿é—®å†…éƒ¨ç³»ç»Ÿã€ä¼šè®®ã€æ–‡æ¡£ | é“¾æ¥æ•£è½åœ¨ IM æˆ–æ–‡æ¡£ä¸­ | ä¼šè®®å‰æ‰“å¼€å¯¼èˆªé¡µè·³è½¬æ‰€æœ‰å†…éƒ¨èµ„æº |

## 3. éœ€æ±‚æ¦‚è¿°
### 3.1 äº§å“ç›®æ ‡
1. **7 å¤©å†…**äº¤ä»˜ MVPï¼Œæ”¯æŒæ¡Œé¢ Web è®¿é—®ã€‚
2. ç”¨æˆ·å¯åœ¨ **3 æ¬¡ç‚¹å‡»å†…**æ‰¾åˆ°ä»»æ„é¢„è®¾ç«™ç‚¹ã€‚
3. æ”¯æŒæœ€å°‘ 3 ä¸ªå¯ç¼–è¾‘åˆ†ç±»ä¸ 15+ ä¸ªç«™ç‚¹æ¡ç›®ã€‚

### 3.2 ç”¨æˆ·æ•…äº‹
| ç¼–å· | ç”¨æˆ·æ•…äº‹ | éªŒæ”¶æ ‡å‡† |
| --- | --- | --- |
| US-01 | ä½œä¸ºå­¦ç”Ÿï¼Œæˆ‘æƒ³åœ¨é¦–é¡µçœ‹åˆ°å­¦ä¹ ç±»ç«™ç‚¹é›†åˆ | é»˜è®¤å±•ç¤ºâ€œå­¦ä¹  / æ•ˆç‡ / å¨±ä¹â€ä¸‰å¤§åˆ†ç±»ï¼Œæ¯ç±»å«è‡³å°‘ 5 ä¸ªé“¾æ¥ |
| US-02 | ä½œä¸ºåˆ›ä½œè€…ï¼Œæˆ‘å¸Œæœ›è‡ªå®šä¹‰ç«™ç‚¹å¹¶æ‹–æ›³æ’åº | æ”¯æŒç«™ç‚¹æ–°å¢ã€ç¼–è¾‘ã€åˆ é™¤ã€æ‹–æ‹½æ’åºå¹¶å®æ—¶ä¿å­˜ |
| US-03 | ä½œä¸ºåä½œæˆå‘˜ï¼Œæˆ‘éœ€è¦å¿«é€Ÿæœç´¢ç«™ç‚¹ | é¡¶éƒ¨æ”¯æŒæ¨¡ç³Šæœç´¢å¹¶å¯é”®ç›˜ä¸Šä¸‹é€‰æ‹©ç»“æœ |

## 4. åŠŸèƒ½éœ€æ±‚
### 4.1 MVP åŠŸèƒ½åˆ—è¡¨
| æ¨¡å— | åŠŸèƒ½ | è¯´æ˜ | ä¼˜å…ˆçº§ |
| --- | --- | --- | --- |
| ä¸»é¡µå¸ƒå±€ | å“åº”å¼ç½‘æ ¼ | æ¡Œé¢ 4 åˆ—ã€å¹³æ¿ 3 åˆ—ã€æ‰‹æœº 2 åˆ— | P0 |
| åˆ†ç±»ç®¡ç† | é¢„è®¾ + è‡ªå®šä¹‰åˆ†ç±» | é»˜è®¤ 3 ç±»ï¼Œå¯å¢åˆ æ”¹åç§° | P0 |
| ç«™ç‚¹å¡ç‰‡ | å›¾æ ‡ã€åç§°ã€æè¿°ã€å¿«æ·é”® | æ”¯æŒ favicon æŠ“å–æˆ–è‡ªå®šä¹‰å›¾æ ‡ | P0 |
| æœç´¢ | é¡¶éƒ¨å³æ—¶æœç´¢ | æ”¯æŒæ‹¼éŸ³ã€åˆ«åï¼Œé”®ç›˜å¯¼èˆª | P0 |
| ä¸»é¢˜åˆ‡æ¢ | æ˜/æš—/è·Ÿéšç³»ç»Ÿ | è®°å¿†ä¸Šæ¬¡é€‰æ‹© | P1 |
| æ•°æ®æŒä¹…åŒ– | LocalStorage | å­˜å‚¨åˆ†ç±»ã€ç«™ç‚¹ä¸ä¸»é¢˜è®¾ç½® | P0 |

### 4.2 è¿­ä»£åŠŸèƒ½å€™é€‰
- ç™»å½•åŒæ­¥ï¼ˆæ¥ç¬¬ä¸‰æ–¹å­˜å‚¨å¦‚ Supabaseï¼‰ã€‚
- æ¨èæ¨¡å—ï¼ˆåŸºäºæ ‡ç­¾æˆ–è®¿é—®é¢‘æ¬¡ï¼‰ã€‚
- å°ç»„ä»¶ï¼šæ¯æ—¥çµæ„Ÿã€ç•ªèŒ„é’Ÿã€å¾…åŠã€‚
- å¯¼èˆªåˆ†äº«ï¼šå¯¼å‡º/å¯¼å…¥è®¾ç½®ã€‚

## 5. ä¿¡æ¯æ¶æ„ä¸é¡µé¢ç»“æ„
- **Header**ï¼šLOGOã€æœç´¢æ¡†ã€ä¸»é¢˜åˆ‡æ¢ã€è®¾ç½®å…¥å£ã€‚
- **Category Tabs**ï¼šæ¨ªå‘ Tab æˆ–ä¾§æ å±•ç¤ºåˆ†ç±»ï¼ŒTab ä¸‹æ–¹æ˜¾ç¤ºå¯¹åº”ç«™ç‚¹ã€‚
- **Site Grid**ï¼šå¡ç‰‡å«å›¾æ ‡ã€æ ‡é¢˜ã€å‰¯æ ‡é¢˜ã€æ”¶è—æ˜Ÿæ ‡ã€å¿«æ·é”®æç¤ºã€‚
- **Footer**ï¼šç‰ˆæƒä¿¡æ¯ã€åé¦ˆå…¥å£ã€ç¤¾åª’é“¾æ¥ã€‚

## 6. äº¤äº’æµç¨‹
1. æ‰“å¼€ç«™ç‚¹ â†’ è¯»å–æœ¬åœ°å­˜å‚¨ â†’ æ¸²æŸ“é»˜è®¤åˆ†ç±»ä¸ç«™ç‚¹ã€‚
2. ç”¨æˆ·åœ¨æœç´¢æ¡†è¾“å…¥å…³é”®è¯ â†’ å®æ—¶è¿‡æ»¤ â†’ é”®ç›˜ Enter æ‰“å¼€é“¾æ¥ï¼ˆæ–°æ ‡ç­¾ï¼‰ã€‚
3. ç‚¹å‡»â€œç¼–è¾‘æ¨¡å¼â€ â†’ è¿›å…¥ç«™ç‚¹ç®¡ç†æµ®å±‚ â†’ å¯å¢åˆ æ”¹å¹¶æ‹–æ‹½æ’åº â†’ ä¿å­˜ååˆ·æ–°ä¸»è§†å›¾ã€‚
4. åˆ‡æ¢ä¸»é¢˜æˆ–åˆ†ç±» â†’ çŠ¶æ€å†™å…¥æœ¬åœ°ï¼Œåˆ·æ–°æ—¶ä¿æŒã€‚

## 7. è§†è§‰ä¸å“ç‰ŒåŸºè°ƒ
- **æƒ…ç»ª**ï¼šæ˜äº®ã€è½»ç›ˆã€æœªæ¥æ„Ÿï¼Œçªå‡ºæ•ˆç‡ä¸é™ªä¼´æ„Ÿã€‚
- **é…è‰²**ï¼šä¸»è‰² #5C6AC4ï¼ˆå…‹è±å› è“è°ƒï¼‰ï¼Œå¼ºè°ƒè‰² #FFB347ï¼ŒèƒŒæ™¯ä½¿ç”¨æŸ”å’Œæ¸å˜ã€‚
- **å­—ä½“**ï¼šä¸­æ–‡é‡‡ç”¨ `HarmonyOS Sans` / è‹±æ–‡ `Inter`ï¼Œå±‚æ¬¡åˆ†æ˜ã€‚
- **å›¾æ ‡**ï¼šFlat + å¾®ç«‹ä½“ï¼Œä¿æŒç»Ÿä¸€åœ†è§’ï¼ˆ8pxï¼‰ã€‚

## 8. æŠ€æœ¯æ–¹æ¡ˆ
- **å‰ç«¯æ¡†æ¶**ï¼šé¦–é€‰ React + Viteï¼Œè‹¥éœ€æ›´è½»é‡å¯è¯„ä¼° SvelteKitã€‚
- **çŠ¶æ€ç®¡ç†**ï¼šè½»é‡åœºæ™¯ä½¿ç”¨ Zustand æˆ–å†…ç½® Contextã€‚
- **ç»„ä»¶åº“**ï¼šTailwind CSS + è‡ªå®šä¹‰ç»„ä»¶ï¼Œå‡å°‘ UI æ­å»ºæˆæœ¬ã€‚
- **æ•°æ®å­˜å‚¨**ï¼šæµè§ˆå™¨ LocalStorageï¼ˆMVPï¼‰ï¼Œé¢„ç•™æ¥å£æ¥å…¥è¿œç«¯å­˜å‚¨ã€‚
- **æ„å»º & éƒ¨ç½²**ï¼šVite æ‰“åŒ…ï¼Œéƒ¨ç½²è‡³ Vercel/é™æ€ç©ºé—´ï¼›å›½å†…é•œåƒæˆ–ä»£ç†ä¸‹è½½ä¾èµ–ã€‚

## 9. å…³é”®æŒ‡æ ‡
- DAU â‰¥ 30ï¼ˆå›¢é˜Ÿè¯•ç”¨é˜¶æ®µï¼‰ã€‚
- ç«™ç‚¹ç‚¹å‡»æˆåŠŸç‡ â‰¥ 95%ã€‚
- æœç´¢å¹³å‡å“åº”æ—¶é—´ â‰¤ 150msã€‚
- è‡ªå®šä¹‰ç«™ç‚¹ç•™å­˜ç‡ â‰¥ 80%ã€‚

## 10. é‡Œç¨‹ç¢‘ä¸ä»»åŠ¡è¿›åº¦
| é˜¶æ®µ | å†…å®¹ | è´Ÿè´£äºº | ç›®æ ‡æ—¥æœŸ | çŠ¶æ€ |
| --- | --- | --- | --- | --- |
| PRD & éœ€æ±‚ç¡®è®¤ | è¾“å‡º PRDã€æ›´æ–° README | ğŸ¤– AI åŠ©æ‰‹ | è¿›è¡Œä¸­ | âœ… å·²å®Œæˆ |
| è®¾è®¡è‰å›¾ | çº¿æ¡†ç¨¿ã€è§†è§‰è§„èŒƒ | å¾…å®š | T+2 å¤© | â³ å¾…å¼€å§‹ |
| å‰ç«¯æ¡†æ¶æ­å»º | åˆå§‹åŒ–é¡¹ç›®ã€ä¸»é¢˜åˆ‡æ¢ã€åˆ†ç±»å±•ç¤º | ğŸ¤– AI åŠ©æ‰‹ | T+4 å¤© | âœ… å·²å®Œæˆ |
| ç«™ç‚¹ç®¡ç†ï¼ˆLocalStorageï¼‰ | æ–°å¢/ç¼–è¾‘/åˆ é™¤/æ‹–æ‹½ | ğŸ¤– AI åŠ©æ‰‹ | T+7 å¤© | âœ… å·²å®Œæˆ |
| æµ‹è¯• & å‘å¸ƒ | è‡ªæµ‹ + éƒ¨ç½² | å¾…å®š | T+9 å¤© | â³ å¾…å¼€å§‹ |
| Supabase äº‘åŒæ­¥ | è¿œç«¯å­˜å‚¨ã€æƒé™æ§åˆ¶ | ğŸ¤– AI åŠ©æ‰‹ | T+10 å¤© | ğŸ› ï¸ è¿›è¡Œä¸­ |

## 11. é£é™©ä¸å¯¹ç­–
- **èŒƒå›´è”“å»¶**ï¼šä¸¥æ ¼æŒ‰ç…§ MVP æ¸…å•è¿­ä»£ï¼Œæ–°å¢éœ€æ±‚éœ€åœ¨ README è®°å½•å¹¶è¯„å®¡ã€‚
- **è§†è§‰èµ„æºä¸è¶³**ï¼šä¼˜å…ˆä½¿ç”¨å¼€æºå›¾æ ‡åº“ï¼ˆIconifyã€Lucideï¼‰ï¼Œå¿…è¦æ—¶å¤–åŒ…è®¾è®¡ã€‚
- **äº¤äº’å¤æ‚åº¦**ï¼šæ‹–æ‹½ã€æœç´¢éœ€é€‰æˆç†Ÿåº“ï¼ˆå¦‚ `dnd-kit`ï¼‰ï¼Œé¿å…é‡å¤é€ è½®å­ã€‚
- **ä¾èµ–ä¸‹è½½å—é™**ï¼šå…¨ç¨‹é…ç½®å›½å†…é•œåƒï¼ˆå¦‚ `npm config set registry https://registry.npmmirror.com`ï¼‰ã€‚

## 12. å½“å‰è¿­ä»£ï¼šSupabase äº‘åŒæ­¥
- **å¼€å‘åˆ†æ”¯**ï¼š`feature/supabase-sync`
- **äº¤ä»˜å†…å®¹**ï¼š
  - å°†åˆ†ç±»ä¸ç«™ç‚¹æ•°æ®çš„è¯»å†™åˆ‡æ¢åˆ° Supabase Postgresï¼Œå¹¶åœ¨è¯·æ±‚å¤±è´¥æ—¶è‡ªåŠ¨é™çº§è‡³å†…ç½®é¢„è®¾ + LocalStorageã€‚
  - ç«™ç‚¹æ–°å¢ / ç¼–è¾‘ / åˆ é™¤ / æ‹–æ‹½æ’åºå…¨éƒ¨ç›´è¿ Supabaseï¼ŒæˆåŠŸååˆ·æ–°ç¼“å­˜ï¼Œä¿æŒå¤šç«¯ä¸€è‡´ã€‚
  - åœ¨ç•Œé¢å†…å±•ç¤ºâ€œåŒæ­¥ä¸­ / å·²ç¦»çº¿ / é‡è¯•â€çŠ¶æ€æç¤ºï¼Œé¿å…è¯¯åˆ¤ã€‚
  - æ¥å…¥ Supabase Authï¼Œç®¡ç†å‘˜ç™»å½•åæ‰èƒ½è®¿é—®ç«™ç‚¹ç®¡ç†å·¥ä½œå°ï¼Œå‰ç«¯ä¼šç²¾å‡†æç¤ºç™»å½•çŠ¶æ€åŠæƒé™ã€‚
  - ç¯å¢ƒå˜é‡ç»Ÿä¸€ä½¿ç”¨ `VITE_SUPABASE_URL` / `VITE_SUPABASE_ANON_KEY`ï¼ˆå¯é€‰ `VITE_SUPABASE_REDIRECT_URL`ï¼‰ï¼Œå…¼å®¹ Cloudflare Pages æ³¨å…¥æ–¹å¼ã€‚
- **éªŒè¯**ï¼š`npm run lint`ã€`npm run build` + Supabase è¯»å†™å†’çƒŸæµ‹è¯•ã€‚
- **åç»­å»ºè®®**ï¼š
  - è®¾è®¡å†²çªå¤„ç†ç­–ç•¥ï¼ˆæœ¬åœ°ä¸´æ—¶ç¼–è¾‘ vs. è¿œç«¯æœ€æ–°ï¼‰ï¼Œä¸ºå¤šäººåä½œåšå‡†å¤‡ã€‚
  - è¯„ä¼°æ€§èƒ½ç›‘æ§ä¸å¤±è´¥å‘Šè­¦æ–¹æ¡ˆï¼Œæ–¹ä¾¿éƒ¨ç½²åæ’æŸ¥ã€‚

### 12.1 éœ€æ±‚å˜æ›´å¿«ç…§
- 2025-11-11ï¼šæ ¹æ®ç”¨æˆ·åé¦ˆï¼Œç§»é™¤ Header å³ä¾§æç¤ºå¡ç‰‡ï¼Œä¸»é¢˜åˆ‡æ¢æ”¹ä¸ºå³ä¸Šè§’çº¯å›¾æ ‡æŒ‰é’®ï¼Œç»´æŒé¡µé¢è½»é‡æ„Ÿã€‚
- 2025-11-11ï¼šåŒæ—¥è¿½åŠ æŒ‡ç¤ºï¼Œå½»åº•åˆ é™¤ Header åŒºåŸŸï¼Œä»…ä¿ç•™ç‹¬ç«‹æœç´¢æ¡†ä¸å³ä¸Šè§’ä¸»é¢˜æŒ‰é’®ï¼Œé¡µé¢ç»“æ„æ›´æç®€ã€‚
- 2025-11-11ï¼šä¼˜åŒ–æœç´¢åŒºä¸ºæ¸å˜æè¾¹+å¿«æ·ç­›é€‰ Chipsï¼Œçªå‡ºæ ¸å¿ƒæ“ä½œå…¥å£å¹¶å¼ºåŒ–å¯ç”¨æ€§ã€‚
- 2025-11-11ï¼šæ–°å¢é¡¶éƒ¨åŒ iconï¼ˆä¸»é¢˜/æœˆäº® + æ”¾å¤§é•œï¼‰ï¼Œæœç´¢æ”¹ä¸ºç‚¹å‡»æ”¾å¤§é•œåå¼¹å‡ºçš„æµ®åŠ¨é¢æ¿ï¼Œé»˜è®¤ä¿æŒæç®€è§†è§‰ã€‚
- 2025-11-11ï¼šä¸Šçº¿çº¯å‰ç«¯ç«™ç‚¹ç®¡ç†å·¥ä½œå°ï¼ˆæ–°å¢/ç¼–è¾‘/æ‹–æ‹½/é‡ç½®ï¼Œå…¨éƒ¨å­˜å…¥ LocalStorageï¼‰ã€‚
- 2025-11-12ï¼šç¡®è®¤ MVP æ¥å…¥ Supabaseï¼Œè¦æ±‚é€šè¿‡ç¯å¢ƒå˜é‡ä¼ å…¥ URL ä¸ Tokenï¼Œå¹¶ç¡®ä¿ Cloudflare Pages éƒ¨ç½²å¯ç›´æ¥é…ç½®ã€‚
- 2025-11-12ï¼šæ–°å¢â€œç®¡ç†å‘˜æƒé™â€éœ€æ±‚ï¼Œç«™ç‚¹ç®¡ç†å…¥å£ä»¥åŠæ‰€æœ‰ CRUD æ“ä½œéœ€ç”± Supabase Auth é‰´æƒåä¸”ç”¨æˆ·è§’è‰²ä¸º `admin` æ‰èƒ½è§¦å‘ã€‚
- 2025-11-12ï¼šæ”¾å¤§é•œæŒ‰é’®è§¦å‘çš„æœç´¢ä½“éªŒè°ƒæ•´ä¸ºå…¨å±å¼¹çª—ï¼Œç»´æŒé¡µé¢æç®€çŠ¶æ€ï¼Œé¿å…å ç”¨ä¸»å†…å®¹ç©ºé—´ã€‚
- 2025-11-12ï¼šæ–°å¢ Cloudflare Worker çº§åˆ«çš„ Supabase ä»£ç†ï¼Œè§£å†³æµè§ˆå™¨ç›´è¿è¢«é˜»æ–­çš„é—®é¢˜ã€‚
- 2025-11-12ï¼šMagic Link æ¨¡æ¿å·²æ”¹ç”¨è‡ªå®šä¹‰åŸŸåä»£ç†ï¼Œä½†å›è·³åä»éœ€æ’æŸ¥ä¼šè¯æœªç”Ÿæ•ˆçš„é—®é¢˜ï¼ˆè§ TODO ç« èŠ‚ï¼‰ã€‚

## 13. ç«™ç‚¹ç®¡ç†ï¼ˆLocalStorageï¼‰
- **çŠ¶æ€**ï¼š`feature/frontend-scaffold` åˆ†æ”¯å·²äº¤ä»˜ï¼Œç­‰å¾…è§†è§‰éªŒæ”¶ã€‚
- **æ ¸å¿ƒèƒ½åŠ›**ï¼š
  - å³ä¸Šè§’æ–°å¢â€œç¼–è¾‘â€ iconï¼Œæ‰“å¼€ä¾§æ»‘ç®¡ç†é¢æ¿ï¼Œå¯æŸ¥çœ‹ 3 å¤§åˆ†ç±»ä¸å…¶ç«™ç‚¹åˆ—è¡¨ã€‚
  - é¢æ¿å†…æ”¯æŒç«™ç‚¹æ–°å¢ã€ç¼–è¾‘ã€åˆ é™¤ï¼Œè¡¨å•å­—æ®µåŒ…å«åˆ†ç±»ã€é“¾æ¥ã€ç®€ä»‹ã€æ ‡ç­¾ã€å¿«æ·é”®ã€Emojiã€‚
  - åŸºäº `@dnd-kit/*` çš„æ‹–æ‹½æ’åºï¼Œåˆ†ç±»å†…é¡ºåºå®æ—¶ä¿å­˜ï¼›ç«™ç‚¹å¡ç‰‡åœ¨ç¼–è¾‘æ¨¡å¼ä¸‹æä¾›â€œç¼–è¾‘/åˆ é™¤â€å¿«æ·æ“ä½œã€‚
  - â€œæ¢å¤é»˜è®¤â€æŒ‰é’®å¯ä¸€é”®æ¸…ç©ºæœ¬åœ°æ•°æ®å¹¶å›åˆ°é¢„è®¾æ¸…å•ï¼Œæ‰€æœ‰çŠ¶æ€æŒä¹…åŒ–åœ¨ `localStorage` çš„ `nav-home-data` é”®ä¸­ã€‚
- **ä¾èµ–**ï¼š`@dnd-kit/core`ã€`@dnd-kit/sortable`ã€`@dnd-kit/modifiers`ã€`@dnd-kit/utilities`ã€‚
- **éªŒè¯**ï¼š`npm run build`ã€`npm run lint`ã€‚
- **åç»­å±•æœ›**ï¼š
  - è¡¥å……æ‰¹é‡å¯¼å…¥/å¯¼å‡ºé…ç½®èƒ½åŠ›ï¼Œæ–¹ä¾¿åˆ†äº«å¯¼èˆªæ¨¡æ¿ã€‚
- è®¾è®¡è·¨è®¾å¤‡åŒæ­¥æ–¹æ¡ˆï¼ˆå¦‚åç»­æ¥ Supabase/Firebaseï¼‰ã€‚

## 14. Supabase äº‘åŒæ­¥ï¼ˆè¿›è¡Œä¸­ï¼‰
- **ç›®æ ‡**ï¼šå°†ç«™ç‚¹/åˆ†ç±»æ•°æ®è¿ç§»è‡³ Supabase Postgresï¼Œå®ç°å¤šäººå…±äº«ã€è¿œç«¯æŒä¹…åŒ–ä¸åç»­æƒé™æ§åˆ¶ã€‚
- **å½“å‰é‡ç‚¹**ï¼š
  - è¿œç«¯è¯»å–å¤±è´¥æ—¶çš„è‡ªåŠ¨é™çº§é€»è¾‘ï¼Œä»¥åŠç¼“å­˜åˆ·æ–°ç­–ç•¥ã€‚
  - ç«™ç‚¹æ’åºã€CRUD æ“ä½œçš„äº‹åŠ¡åŒ–ä¸å¤±è´¥å›æ»šæç¤ºã€‚
- **ç¯å¢ƒå˜é‡**ï¼š
  - æœ¬åœ°å¼€å‘ï¼šåœ¨æ ¹ç›®å½•åˆ›å»º `.env.local` å¹¶é…ç½®ä»¥ä¸‹é”®ï¼ˆå·²æä¾› `.env.example`ï¼‰ï¼š
    ```
    VITE_SUPABASE_URL=https://xomknvyqnrigbxcdbjtx.supabase.co
    VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhvbWtudnlxbnJpZ2J4Y2RianR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3NTMzMjUsImV4cCI6MjA3ODMyOTMyNX0.3L1QOc1o3fgZBMnJxlL286uFvMhdWiKJ0JFzbtD-iZs
    VITE_SUPABASE_REDIRECT_URL=http://localhost:5173
    ```
  - Cloudflare Pagesï¼š
    - `Settings > Environment variables` ä¸­ä¸ºå‰ç«¯é…ç½®åŒåå˜é‡ã€‚è‹¥éœ€è¦ä½¿ç”¨å†…ç½®ä»£ç†ï¼Œè¯·æŠŠ `VITE_SUPABASE_URL` è®¾ç½®ä¸º `https://<your-pages-domain>/api/supabase`ï¼ˆé¢„è§ˆç¯å¢ƒå¯æ”¹ä¸ºå¯¹åº”åŸŸåï¼‰ã€‚
    - `Settings > Functions > Environment variables` å†…æ–°å¢ï¼š
      - `SUPABASE_URL`ï¼šçœŸå®çš„ Supabase é¡¹ç›® URLï¼ˆä¸æœ¬åœ°ä¸€è‡´ï¼‰ã€‚
      - `SUPABASE_ANON_KEY`ï¼šåŒä¸€ä¸ª anon keyï¼ŒWorker ä¼šè‡ªåŠ¨æ³¨å…¥è¯·æ±‚ã€‚
  > è‹¥éœ€æ›´ç»†æƒé™ï¼Œè¯·åœ¨ Supabase æ§åˆ¶å°ç”Ÿæˆæ–°çš„ anon/service keyï¼Œé¿å…æ³„éœ²æ•°æ®åº“ root å¯†ç ã€‚
- **è¡¨ç»“æ„å»ºè®®**ï¼š
  ```sql
  create table public.categories (
    id text primary key,
    label text not null,
    emoji text,
    description text,
    sort_order int default 0
  );

  create table public.sites (
    id text primary key,
    category_id text references public.categories(id) on delete cascade,
    name text not null,
    description text,
    url text not null,
    tags text[],
    shortcut text,
    emoji text,
    sort_order int default 0,
    created_at timestamp with time zone default timezone('utc'::text, now())
  );
  ```
- **æ•°æ®æµ**ï¼š
  - App å¯åŠ¨ â†’ å°è¯•æ‹‰å– Supabase åˆ†ç±»/ç«™ç‚¹ â†’ æˆåŠŸåˆ™æ¸²æŸ“è¿œç«¯æ•°æ®ï¼Œå¹¶ç¼“å­˜åˆ° LocalStorage ä½œä¸ºå…œåº•ã€‚
  - è‹¥ç½‘ç»œæˆ– env ç¼ºå¤±åˆ™è¿›å…¥â€œç¦»çº¿æ¨¡å¼â€ï¼Œä½¿ç”¨æœ¬åœ°é¢„è®¾+LocalStorageï¼Œå¹¶æç¤ºéœ€è¦é…ç½® Supabaseã€‚
  - ç™»å½•æµç¨‹ï¼šç®¡ç†å‘˜åœ¨å‰ç«¯è¾“å…¥é‚®ç®± â†’ Supabase å‘é€ä¸€æ¬¡æ€§ Magic Link â†’ ç™»å½•æˆåŠŸåæ ¹æ® `app_metadata.role` åˆ¤æ–­æ˜¯å¦ä¸º adminï¼›ä»… admin å¯æ‰“å¼€ç«™ç‚¹ç®¡ç†ä¸è§¦å‘ CRUDã€‚
  - CRUD & æ‹–æ‹½æ“ä½œå‡è°ƒç”¨ Supabase APIï¼ŒæˆåŠŸååˆ·æ–°å†…å­˜æ€ï¼›å¤±è´¥ä¼šæç¤ºå¹¶å›æ»šã€‚
  - **Cloudflare Worker ä»£ç†æ¨¡å¼**ï¼šæµè§ˆå™¨è¯·æ±‚ç»Ÿä¸€å‘å¾€ `/api/supabase/*`ï¼Œç”± `functions/api/supabase/[[path]].js` è½¬å‘åˆ° Supabaseï¼Œä»è€Œè§„é¿å›½å†…ç›´è¿å—é˜»çš„é—®é¢˜ã€‚

## 15. Cloudflare Supabase ä»£ç†
- **æ–‡ä»¶**ï¼š`functions/api/supabase/[[path]].js`ï¼Œè‡ªåŠ¨åŒ¹é… `rest/v1`ã€`auth/v1` ç­‰è·¯å¾„å¹¶æºå¸¦å¿…è¦ headerã€‚
- **éƒ¨ç½²æ­¥éª¤**ï¼š
  1. åœ¨ Cloudflare Pages é¡¹ç›®ä¸­å¯ç”¨ Functionsï¼ˆé»˜è®¤å³ç”Ÿæ•ˆï¼‰ã€‚
  2. å¡«å†™ Functions ç¯å¢ƒå˜é‡ `SUPABASE_URL` ä¸ `SUPABASE_ANON_KEY`ã€‚
  3. å°†å‰ç«¯æ„å»ºæ—¶çš„ `VITE_SUPABASE_URL` æŒ‡å‘ `https://<domain>/api/supabase`ï¼ˆé¢„è§ˆåŸŸåä¹Ÿéœ€å¯¹åº”è®¾ç½®ï¼‰ã€‚
  4. é‡æ–°æ„å»ºå‘å¸ƒå³å¯ï¼Œæµè§ˆå™¨æ‰€æœ‰ Supabase æµé‡éƒ½ä¼šèµ° Cloudflare å‡ºå£ã€‚
- **è°ƒè¯•å»ºè®®**ï¼š
  - æœ¬åœ°ä»å¯ç›´æ¥è®¿é—® Supabaseï¼ˆä¿æŒ `VITE_SUPABASE_URL` ä¸ºçœŸå®åŸŸåï¼‰ï¼Œè‹¥éœ€è°ƒè¯•ä»£ç†ï¼Œå¯ä½¿ç”¨ `npx wrangler dev functions/api/supabase` æˆ– `npx miniflare`ã€‚
  - å¦‚éœ€è¿›ä¸€æ­¥éšè— anon keyï¼Œå¯åœ¨ Worker å†…æ”¹ç”¨ `SUPABASE_SERVICE_ROLE_KEY` å¹¶åœ¨å‰ç«¯ç§»é™¤ keyï¼Œä½†éœ€åŒæ­¥è°ƒæ•´ RLS ä¸é‰´æƒé€»è¾‘ã€‚

## 16. TODO & æœªè§£å†³é¡¹
- ~~Magic Link ç™»å½•åä»æç¤ºæœªç™»å½•~~ï¼ˆ2025-11-13 âœ…ï¼‰ï¼šå‰ç«¯å·²æ–°å¢ Magic Link å›è°ƒè§£æï¼Œè‡ªåŠ¨æ³¨å…¥ `access_token / refresh_token` æˆ– `code` äº¤æ¢é€»è¾‘ï¼Œå›è·³åå¯ç«‹å³è¯†åˆ«ç®¡ç†å‘˜æƒé™ã€‚
- æš‚æ— æ–°çš„æœªè§£å†³é¡¹ï¼Œå¦‚æœ‰æ–°å¢é—®é¢˜è¯·åœ¨æ­¤è®°å½•ã€‚

### 14.1 ç®¡ç†å‘˜é‰´æƒè¦æ±‚
- **è§’è‰²æ ‡è®°**ï¼šåœ¨ Supabase Dashboard â†’ Authentication â†’ Users ä¸­é€‰ä¸­ç®¡ç†å‘˜è´¦å·ï¼Œç¼–è¾‘ `App metadata`ï¼Œè®¾ç½® `{"role": "admin"}`ï¼ˆæˆ–åœ¨ `roles` æ•°ç»„ä¸­åŒ…å« `admin`ï¼‰ã€‚
- **Magic Link é…ç½®**ï¼šå¯ç”¨ Email OTP/Magic Link ç™»å½•ï¼Œå¹¶åœ¨é¡¹ç›®è®¾ç½®ä¸­å…è®¸å‰ç«¯åŸŸåï¼›`VITE_SUPABASE_REDIRECT_URL` å¯æŒ‡å®š Cloudflare Pages æœ€ç»ˆ URLï¼Œæœªè®¾ç½®åˆ™é»˜è®¤å–å½“å‰ç«™ç‚¹ã€‚
- **RLS å»ºè®®**ï¼šå¯é’ˆå¯¹ `sites` / `categories` è¡¨ç¼–å†™ Policyï¼Œé™åˆ¶å†™å…¥æ“ä½œ `auth.jwt() ->> 'role' = 'admin'`ï¼›å½“å‰å‰ç«¯å·²åšæ˜¾å¼æ‹¦æˆªï¼ŒæœåŠ¡ç«¯ç­–ç•¥å¯è¿›ä¸€æ­¥å…œåº•ã€‚
- **ç™»å‡ºä¸çŠ¶æ€**ï¼šå‰ç«¯ä¼šåœ¨å¯¼èˆªåŒºå±•ç¤ºâ€œç®¡ç†å‘˜ / è®¿å®¢â€çŠ¶æ€ï¼Œæä¾›ç™»å½•å…¥å£ä¸å®‰å…¨é€€å‡ºæŒ‰é’®ï¼Œæœªç™»å½•æ—¶ action button ä¼šæé†’æ— æ³•ç¼–è¾‘ã€‚
- **ä»»åŠ¡æ‹†è§£**ï¼š
  1. å¼•å…¥ `@supabase/supabase-js`ï¼Œå°è£…å®¢æˆ·ç«¯ä¸é”™è¯¯å¤„ç†ã€‚
  2. æ”¹é€ ç°æœ‰ç«™ç‚¹ç®¡ç†é€»è¾‘ï¼Œä½¿å…¶ä¼˜å…ˆä½¿ç”¨ Supabaseï¼ŒLocalStorage ä»…ä½œç¼“å­˜ã€‚
  3. å¢åŠ åŒæ­¥çŠ¶æ€æç¤ºï¼ˆåŠ è½½ä¸­ã€ç¦»çº¿ã€å¤±è´¥é‡è¯•ç­‰ï¼‰ã€‚
  4. æ›´æ–°æµ‹è¯•/éƒ¨ç½²æ–‡æ¡£ï¼Œç¡®ä¿ env ç®¡ç†è§„èŒƒã€‚

---
å¦‚éœ€æ–°å¢éœ€æ±‚ã€è®¾è®¡æˆ–å¼€å‘ä»»åŠ¡ï¼Œè¯·å…ˆæ²Ÿé€šç¡®è®¤ï¼Œå¹¶åœ¨ README çš„ç›¸å…³ç« èŠ‚åŒæ­¥è®°å½•ã€‚
